/*!
* basket.js
* v0.3.0 - 2012-12-28
* http://addyosmani.github.com/basket.js
* (c) Addy Osmani; MIT License
* Created by: Addy Osmani, Sindre Sorhus, Andr√©e Hansson
* Contributors: Ironsjp, Mathias Bynens, Rick Waldron, Felipe Morais
* Uses rsvp.js, https://github.com/tildeio/rsvp.js
*/
(function(e,t){"use strict";RSVP.all=function(e){var t,n=[],r=new RSVP.Promise,i=e.length,s=function(e){return function(t){o(e,t)}},o=function(e,t){n[e]=t,--i===0&&r.resolve(n)},u=function(e){r.reject(e)};for(t=0;t<i;t++)e[t].then(s(t),u);return r};var n=t.head||t.getElementsByTagName("head")[0],r="basket-",i=5e3,s=function(e,t){try{return localStorage.setItem(r+e,JSON.stringify(t)),!0}catch(n){if(n.name.toUpperCase().indexOf("QUOTA")>=0){var i,o=[];for(i in localStorage)i.indexOf(r)===0&&o.push(JSON.parse(localStorage[i]));if(o.length)return o.sort(function(e,t){return e.stamp-t.stamp}),basket.remove(o[0].key),s(e,t);return}return}},o=function(e){var t=new XMLHttpRequest,n=new RSVP.Promise;return t.open("GET",e),t.onreadystatechange=function(){t.readyState===4&&(t.status===200?n.resolve(t.responseText):n.reject(new Error(t.statusText)))},t.send(),n},u=function(e){return o(e.url).then(function(t){var n=f(e,t);return s(e.key,n),t})},a=function(e){var r=t.createElement("script");r.defer=!0,r.text=e,n.appendChild(r)},f=function(e,t){var n=+(new Date);return e.data=t,e.stamp=n,e.expire=n+(e.expire||i)*60*60*1e3,e},l=function(e){var t,n;if(!e.url)return;return e.key=e.key||e.url,t=basket.get(e.key),e.execute=e.execute!==!1,!t||t.expire- +(new Date)<0||e.unique!==t.unique?(e.unique&&(e.url+=(e.url.indexOf("?")>0?"&":"?")+"basket-unique="+e.unique),n=u(e)):(n=new RSVP.Promise,n.resolve(t.data)),e.execute?n.then(a):n};e.basket={require:function(){var e,t,n=[];for(e=0,t=arguments.length;e<t;e++)n.push(l(arguments[e]));return RSVP.all(n)},remove:function(e){return localStorage.removeItem(r+e),this},get:function(e){var t=localStorage.getItem(r+e);try{return JSON.parse(t||"false")}catch(n){return!1}},clear:function(e){var t,n,i=+(new Date);for(t in localStorage)n=t.split(r)[1],n&&(!e||this.get(n).expire<=i)&&this.remove(n);return this}},basket.clear(!0)})(this,document);